<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>êµìœ¡ ëª…ë‹¨ ê´€ë¦¬</title>
  <style>
    :root{--bg:#0b0d12;--card:#121620;--muted:#94a3b8;--border:#233046;--ink:#e5e7eb;--primary:#1d4ed8;--success:#10b981;--warning:#f59e0b;--error:#ef4444}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,'Noto Sans KR',sans-serif;padding:20px}
    .container{max-width:900px;margin:0 auto}.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:32px;margin-bottom:24px;box-shadow:0 10px 25px rgba(0,0,0,.2)}
    h1{margin:0 0 8px;color:var(--ink)}.subtitle{color:var(--muted);margin-bottom:32px}
    .form-group{margin-bottom:20px}.form-row{display:grid;gap:16px;grid-template-columns:1fr 1fr}@media(max-width:768px){.form-row{grid-template-columns:1fr}}
    .form-triple{display:grid;gap:16px;grid-template-columns:2fr 1fr 1fr}@media(max-width:768px){.form-triple{grid-template-columns:1fr}}
    label{display:block;font-weight:600;margin-bottom:8px;color:var(--ink)}
    input[type="text"],input[type="date"],textarea{width:100%;padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:#0f1320;color:var(--ink);font-size:16px;font-family:inherit;transition:border-color .3s}
    textarea{min-height:150px;resize:vertical} input:focus,textarea:focus{outline:none;border-color:var(--primary)}
    .btn{border:1px solid var(--border);background:#101826;color:var(--ink);padding:12px 24px;border-radius:10px;cursor:pointer;font-size:16px;font-weight:500;transition:.3s;text-decoration:none;display:inline-flex;align-items:center;gap:8px;margin-right:12px;margin-bottom:8px}
    .btn:hover{background:#1a2332;border-color:var(--primary)}.btn.primary{border-color:#2563eb;background:var(--primary)}.btn.primary:hover{background:#1e40af}
    .btn.success{border-color:var(--success);background:var(--success);color:#000}.btn.warning{border-color:var(--warning);background:var(--warning);color:#000}
    .btn.pdf{border-color:#8b5cf6;background:#8b5cf6;color:#fff}.btn.pdf:hover{background:#7c3aed}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .status{padding:12px 16px;border-radius:8px;margin:16px 0;font-weight:500;display:none}
    .status.success{background:rgba(16,185,129,.2);color:var(--success);border:1px solid var(--success)}
    .status.error{background:rgba(239,68,68,.2);color:var(--error);border:1px solid var(--error)}
    .status.info{background:rgba(29,78,216,.2);color:var(--primary);border:1px solid var(--primary)}
    .back-link{position:fixed;top:20px;left:20px;color:var(--muted);text-decoration:none;font-size:14px;padding:8px 12px;border:1px solid var(--border);border-radius:6px;background:var(--card);transition:.3s}
    .back-link:hover{color:var(--ink);border-color:var(--primary)} .help-text{font-size:14px;color:var(--muted);margin-top:4px}
    .url-box{background:#0f1320;border:2px solid var(--primary);border-radius:12px;padding:20px;margin-top:20px;text-align:center}
    .main-url{font-family:'Courier New',monospace;font-size:18px;font-weight:bold;color:var(--primary);word-break:break-all;margin-bottom:12px}
    .copy-btn{padding:8px 16px;background:var(--primary);border:none;border-radius:6px;color:#fff;cursor:pointer;font-weight:500;transition:.3s}
    .copy-btn:hover{background:#1e40af}
    .feature-box{background:#0a0f19;border:1px solid var(--border);border-radius:10px;padding:16px;margin-top:20px}
    .feature-title{font-weight:600;color:var(--success);margin-bottom:8px}
    .loading-spinner{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-radius:50%;border-top-color:var(--primary);animation:spin 1s ease-in-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .roster-list{background:#1a1f2e;border:2px solid #8b5cf6;border-radius:12px;padding:24px;margin-top:24px}
    .roster-title{color:#8b5cf6;font-size:20px;font-weight:600;margin-bottom:16px;text-align:center}
    .roster-item{background:#0f1320;border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
    .roster-info{flex:1;min-width:200px}
    .roster-main{font-weight:600;color:var(--ink);margin-bottom:4px}
    .roster-details{color:var(--muted);font-size:14px}
    .roster-actions{display:flex;gap:8px;flex-wrap:wrap}
    .roster-actions .btn{margin:0;padding:8px 16px;font-size:14px}
    .no-rosters{text-align:center;color:var(--muted);padding:20px}
    .status-badge{display:inline-block;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;margin-left:8px}
    .status-active{background:rgba(16,185,129,.2);color:var(--success)}
    .status-upcoming{background:rgba(29,78,216,.2);color:var(--primary)}
    .status-completed{background:rgba(107,114,128,.2);color:#9ca3af}
  </style>
</head>
<body>
  <a href="index.html" class="back-link">â† ë©”ì¸ í˜ì´ì§€</a>

  <div class="container">
    <div class="card">
      <h1>êµìœ¡ ëª…ë‹¨ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
      <p class="subtitle">êµìœ¡ ì •ë³´ì™€ ì°¸ì—¬ì ëª…ë‹¨ì„ ë“±ë¡í•˜ë©´ ë©”ì¸ í˜ì´ì§€ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

      <form id="rosterForm">
        <div class="form-triple">
          <div class="form-group">
            <label for="course">êµìœ¡ëª… *</label>
            <input type="text" id="course" placeholder="ì˜ˆ: AI ê´€ë¦¬ì êµìœ¡" required>
          </div>
          <div class="form-group">
            <label for="startDate">ì‹œì‘ì¼ *</label>
            <input type="date" id="startDate" required>
          </div>
          <div class="form-group">
            <label for="endDate">ëì¼ *</label>
            <input type="date" id="endDate" required>
          </div>
        </div>

        <div class="form-group">
          <label for="memo">ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
          <input type="text" id="memo" placeholder="ì˜ˆ: 1ì°¨ìˆ˜, ì˜¤í›„ë°˜">
          <div class="help-text">êµìœ¡ êµ¬ë¶„ì´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
        </div>

        <div class="form-group">
          <label for="names">ì°¸ì—¬ì ëª…ë‹¨ *</label>
          <textarea id="names" placeholder="í™ê¸¸ë™,ê¹€ì² ìˆ˜,ì´ì˜í¬&#10;ë˜ëŠ”&#10;í™ê¸¸ë™&#10;ê¹€ì² ìˆ˜&#10;ì´ì˜í¬&#10;&#10;ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ê±°ë‚˜ í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥í•´ì£¼ì„¸ìš”" required></textarea>
        </div>

        <div style="text-align:center;">
          <button type="submit" class="btn primary" id="saveBtn">
            <span id="saveText">ëª…ë‹¨ ë“±ë¡í•˜ê¸°</span>
            <span id="saveSpinner" class="loading-spinner" style="display:none;"></span>
          </button>
          <button type="button" class="btn" id="clearBtn">ì´ˆê¸°í™”</button>
        </div>

        <div id="status" class="status"></div>
      </form>

      <div class="url-box">
        <div class="main-url" id="mainUrl"></div>
        <button class="copy-btn" onclick="copyMainUrl()">ë©”ì¸ ì£¼ì†Œ ë³µì‚¬</button>
        <div class="help-text" style="margin-top:12px;">ëª…ë‹¨ ë“±ë¡ í›„ ìœ„ ì£¼ì†Œë¥¼ ì°¸ì—¬ìë“¤ì—ê²Œ ê³µìœ í•˜ì„¸ìš”</div>
      </div>
    </div>

    <!-- ë“±ë¡ëœ êµìœ¡ ëª©ë¡ ë° PDF ìƒì„± -->
    <div class="roster-list">
      <div class="roster-title">ğŸ“š ë“±ë¡ëœ êµìœ¡ ëª©ë¡</div>
      <div id="rosterListContent">
        <div class="loading" style="text-align:center;color:var(--muted);padding:20px;">
          ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
          <div class="loading-spinner" style="margin-left:8px;"></div>
        </div>
      </div>
      <div style="text-align:center;margin-top:16px;">
        <button type="button" class="btn" id="refreshBtn">ìƒˆë¡œê³ ì¹¨</button>
      </div>
    </div>

    <div class="feature-box">
      <div class="feature-title">ğŸ“‹ ì‚¬ìš© ë°©ë²•</div>
      <div class="help-text">
        1) êµìœ¡ ì •ë³´ì™€ ì°¸ì—¬ì ëª…ë‹¨ ì…ë ¥ â†’ "ëª…ë‹¨ ë“±ë¡í•˜ê¸°"<br>
        2) ë©”ì¸ ì£¼ì†Œ ê³µìœ  â†’ ì°¸ì—¬ìê°€ êµìœ¡ ê¸°ê°„ ì¤‘ ì–¸ì œë“  ì„œëª… ê°€ëŠ¥<br>
        3) ì„œëª… ì™„ë£Œ í›„ â†’ í•´ë‹¹ êµìœ¡ì˜ "PDF ìƒì„±" ë²„íŠ¼ í´ë¦­<br>
        4) ìƒì„±ëœ PDF íŒŒì¼ ë‹¤ìš´ë¡œë“œ â†’ ë³´ê´€ ë° ê´€ë¦¬<br>
        5) ì™„ë£Œëœ êµìœ¡ì€ "ì‚­ì œ" ë²„íŠ¼ìœ¼ë¡œ ì •ë¦¬
      </div>
    </div>
  </div>

  <script>
    // ğŸ‘‡ ìƒˆë¡œ ë°°í¬í•œ Apps Script WebApp URL
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwnj4rAzKhWD8gdvd1gbHdjbMrKJA_FiqAK5-LXAUgHIvqYupsj0BX2XatWD8v-Tb2EaA/exec';

    document.addEventListener('DOMContentLoaded', ()=>{
      const today=new Date().toISOString().split('T')[0];
      document.getElementById('startDate').value=today;
      
      // ëì¼ì€ ì‹œì‘ì¼ + 7ì¼ë¡œ ê¸°ë³¸ ì„¤ì •
      const nextWeek=new Date();
      nextWeek.setDate(nextWeek.getDate()+7);
      document.getElementById('endDate').value=nextWeek.toISOString().split('T')[0];
      
      const base=window.location.origin+window.location.pathname.replace('admin.html','index.html');
      document.getElementById('mainUrl').textContent=base;
      loadRosterList();
      
      // ì‹œì‘ì¼ ë³€ê²½ ì‹œ ëì¼ë„ ìë™ ì¡°ì •
      document.getElementById('startDate').addEventListener('change',function(){
        const startDate=new Date(this.value);
        const endDate=new Date(document.getElementById('endDate').value);
        if(endDate<=startDate){
          startDate.setDate(startDate.getDate()+1);
          document.getElementById('endDate').value=startDate.toISOString().split('T')[0];
        }
      });
    });

    function showStatus(m,t='info'){const el=document.getElementById('status');el.textContent=m;el.className=`status ${t}`;el.style.display='block';if(t==='success'||t==='error'){setTimeout(()=>el.style.display='none',8000);}}
    function hideStatus(){document.getElementById('status').style.display='none';}
    function setLoading(b){const btn=document.getElementById('saveBtn');const text=document.getElementById('saveText');const sp=document.getElementById('saveSpinner');btn.disabled=b;text.style.display=b?'none':'inline';sp.style.display=b?'inline-block':'none';}

    function handleSubmit(e){
      e.preventDefault();
      const course=document.getElementById('course').value.trim();
      const startDate=document.getElementById('startDate').value;
      const endDate=document.getElementById('endDate').value;
      const memo=document.getElementById('memo').value.trim();
      const namesText=document.getElementById('names').value.trim();
      
      if(!course||!startDate||!endDate||!namesText){
        showStatus('êµìœ¡ëª…, ì‹œì‘ì¼, ëì¼, ì°¸ì—¬ì ëª…ë‹¨ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.','error');
        return;
      }
      
      if(new Date(startDate)>=new Date(endDate)){
        showStatus('ëì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ë’¤ì—¬ì•¼ í•©ë‹ˆë‹¤.','error');
        return;
      }
      
      const names=(namesText.includes(',')?namesText.split(','):namesText.split('\n')).map(n=>n.trim()).filter(Boolean);
      if(!names.length){showStatus('ì˜¬ë°”ë¥¸ ì°¸ì—¬ì ëª…ë‹¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.','error');return;}

      setLoading(true); showStatus('ëª…ë‹¨ì„ ë“±ë¡í•˜ëŠ” ì¤‘...','info');
      const cb='saveRosterCallback_'+Date.now(); 
      const to=setTimeout(()=>{showStatus('ì„œë²„ ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.','error');cleanup();},30000);
      function cleanup(){clearTimeout(to);delete window[cb];const s=document.getElementById('save-jsonp-script');if(s&&s.parentNode)document.head.removeChild(s);setLoading(false);}
      window[cb]=function(result){
        try{
          if(result&&result.ok){
            showStatus(`ëª…ë‹¨ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! (${names.length}ëª…)`,'success');
            document.getElementById('names').value='';
            loadRosterList();
          }else{
            throw new Error(result?.error||'ëª…ë‹¨ ë“±ë¡ ì‹¤íŒ¨');
          }
        }catch(err){
          showStatus('ëª…ë‹¨ ë“±ë¡ ì‹¤íŒ¨: '+err.message,'error');
        }finally{
          cleanup();
        }
      };
      const params=new URLSearchParams({
        action:'saveRoster',course,startDate,endDate,memo,names:names.join(','),callback:cb,_t:Date.now()
      });
      const s=document.createElement('script'); 
      s.id='save-jsonp-script'; 
      s.src=`${APPS_SCRIPT_URL}?${params.toString()}`; 
      s.onerror=function(){showStatus('ì„œë²„ ì—°ê²° ì˜¤ë¥˜','error');cleanup();}; 
      document.head.appendChild(s);
    }

    function loadRosterList(){
      const cb='loadRosterListCallback_'+Date.now();
      const to=setTimeout(()=>{showRosterError('ì„œë²„ ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.');cleanup();},30000);
      function cleanup(){clearTimeout(to);delete window[cb];const s=document.getElementById('roster-list-script');if(s&&s.parentNode)document.head.removeChild(s);}
      
      window[cb]=function(result){
        try{
          if(result&&result.ok){
            displayRosterList(result.rosters||[]);
          }else{
            throw new Error(result?.error||'êµìœ¡ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
        }catch(err){
          showRosterError('ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: '+err.message);
        }finally{
          cleanup();
        }
      };
      
      const params=new URLSearchParams({action:'getAllRosters',callback:cb,_t:Date.now()});
      const s=document.createElement('script');
      s.id='roster-list-script';
      s.src=`${APPS_SCRIPT_URL}?${params.toString()}`;
      s.onerror=function(){showRosterError('ì„œë²„ ì—°ê²° ì˜¤ë¥˜');cleanup();};
      document.head.appendChild(s);
    }

    function displayRosterList(rosters){
      const container=document.getElementById('rosterListContent');
      
      if(!rosters||rosters.length===0){
        container.innerHTML='<div class="no-rosters">ë“±ë¡ëœ êµìœ¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      
      container.innerHTML=rosters.map((roster,index)=>{
        const startDate=roster.startDate||'ì‹œì‘ì¼ì—†ìŒ';
        const endDate=roster.endDate||'ëì¼ì—†ìŒ';
        const memoStr=roster.memo?` | ${roster.memo}`:'';
        
        let statusBadge='';
        let statusText='';
        if(roster.status==='active'){
          statusBadge='<span class="status-badge status-active">ì§„í–‰ì¤‘</span>';
          statusText='ì§„í–‰ì¤‘';
        }else if(roster.status==='upcoming'){
          statusBadge='<span class="status-badge status-upcoming">ì˜ˆì •</span>';
          statusText='ì˜ˆì •';
        }else{
          statusBadge='<span class="status-badge status-completed">ì™„ë£Œ</span>';
          statusText='ì™„ë£Œ';
        }
        
        return `
          <div class="roster-item">
            <div class="roster-info">
              <div class="roster-main">${roster.course||'êµìœ¡ëª…ì—†ìŒ'}${statusBadge}</div>
              <div class="roster-details">
                ğŸ“… ${startDate} ~ ${endDate}${memoStr} | ğŸ‘¥ ${roster.count||0}ëª… 
                | ğŸ“ ${new Date(roster.regTime).toLocaleDateString('ko-KR')} ë“±ë¡
              </div>
            </div>
            <div class="roster-actions">
              <button class="btn pdf" onclick="generatePDFForRoster('${roster.course}','${startDate}','${endDate}','${roster.memo||''}')">
                ğŸ“„ PDF ìƒì„±
              </button>
              <button class="btn warning" onclick="deleteRoster('${roster.course}','${startDate}','${endDate}','${roster.memo||''}')">
                ğŸ—‘ï¸ ì‚­ì œ
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function showRosterError(msg){
      document.getElementById('rosterListContent').innerHTML=`<div class="no-rosters" style="color:var(--error);">${msg}</div>`;
    }

    function generatePDFForRoster(course,startDate,endDate,memo){
      if(!course||!startDate||!endDate){
        showStatus('êµìœ¡ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.','error');
        return;
      }

      const buttons=document.querySelectorAll('.btn.pdf');
      buttons.forEach(btn=>{btn.disabled=true;btn.textContent='ìƒì„± ì¤‘...';});

      showStatus(`"${course}" êµìœ¡ì˜ ì„œëª… ëª¨ìŒì§‘ PDFë¥¼ ìƒì„±í•˜ëŠ” ì¤‘... (ìµœëŒ€ 1ë¶„ ì†Œìš”)`,'info');

      const cb='generatePDFCallback_'+Date.now();
      const to=setTimeout(()=>{
        showStatus('PDF ìƒì„± ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.','error');
        cleanup();
      },90000);

      function cleanup(){
        clearTimeout(to);
        delete window[cb];
        const s=document.getElementById('pdf-jsonp-script');
        if(s&&s.parentNode)document.head.removeChild(s);
        buttons.forEach(btn=>{btn.disabled=false;btn.textContent='ğŸ“„ PDF ìƒì„±';});
      }

      window[cb]=function(result){
        try{
          if(result&&result.ok){
            showStatus(`PDF ìƒì„± ì™„ë£Œ! (${result.participantCount}ëª…ì˜ ì„œëª… í¬í•¨)`,'success');
            setTimeout(()=>{
              if(confirm('PDFê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
                window.open(result.pdfUrl,'_blank');
              }
            },1000);
          }else{
            throw new Error(result?.error||'PDF ìƒì„± ì‹¤íŒ¨');
          }
        }catch(err){
          showStatus('PDF ìƒì„± ì‹¤íŒ¨: '+err.message,'error');
        }finally{
          cleanup();
        }
      };

      const params=new URLSearchParams({
        action:'generatePDF',course,startDate,endDate,memo:memo||'',callback:cb,_t:Date.now()
      });

      const s=document.createElement('script');
      s.id='pdf-jsonp-script';
      s.src=`${APPS_SCRIPT_URL}?${params.toString()}`;
      s.onerror=function(){showStatus('ì„œë²„ ì—°ê²° ì˜¤ë¥˜','error');cleanup();};
      document.head.appendChild(s);
    }

    function deleteRoster(course,startDate,endDate,memo){
      if(!confirm(`"${course}" êµìœ¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)){
        return;
      }

      showStatus('êµìœ¡ ëª…ë‹¨ì„ ì‚­ì œí•˜ëŠ” ì¤‘...','info');

      const cb='deleteRosterCallback_'+Date.now();
      const to=setTimeout(()=>{
        showStatus('ì‚­ì œ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.','error');
        cleanup();
      },30000);

      function cleanup(){
        clearTimeout(to);
        delete window[cb];
        const s=document.getElementById('delete-jsonp-script');
        if(s&&s.parentNode)document.head.removeChild(s);
      }

      window[cb]=function(result){
        try{
          if(result&&result.ok){
            showStatus(`êµìœ¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`,'success');
            loadRosterList();
          }else{
            throw new Error(result?.error||'ì‚­ì œ ì‹¤íŒ¨');
          }
        }catch(err){
          showStatus('ì‚­ì œ ì‹¤íŒ¨: '+err.message,'error');
        }finally{
          cleanup();
        }
      };

      const params=new URLSearchParams({
        action:'deleteRoster',course,startDate,endDate,memo:memo||'',callback:cb,_t:Date.now()
      });

      const s=document.createElement('script');
      s.id='delete-jsonp-script';
      s.src=`${APPS_SCRIPT_URL}?${params.toString()}`;
      s.onerror=function(){showStatus('ì„œë²„ ì—°ê²° ì˜¤ë¥˜','error');cleanup();};
      document.head.appendChild(s);
    }

    function clearForm(){
      document.getElementById('course').value='';
      const today=new Date().toISOString().split('T')[0];
      document.getElementById('startDate').value=today;
      const nextWeek=new Date();
      nextWeek.setDate(nextWeek.getDate()+7);
      document.getElementById('endDate').value=nextWeek.toISOString().split('T')[0];
      document.getElementById('memo').value='';
      document.getElementById('names').value='';
      hideStatus();
    }

    function copyMainUrl(){
      const url=document.getElementById('mainUrl').textContent;
      if(navigator.clipboard&&window.isSecureContext){
        navigator.clipboard.writeText(url).then(()=>showStatus('ë©”ì¸ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.','success')).catch(()=>fallback(url));
      } else {
        fallback(url);
      }
    }

    function fallback(text){
      const ta=document.createElement('textarea');
      ta.value=text;
      ta.style.position='fixed';
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      try{
        document.execCommand('copy')?showStatus('ë©”ì¸ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.','success'):showStatus('ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ ë³µì‚¬í•´ì£¼ì„¸ìš”.','error');
      }catch(e){
        showStatus('ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ ë³µì‚¬í•´ì£¼ì„¸ìš”.','error');
      }
      document.body.removeChild(ta);
    }

    document.getElementById('rosterForm').addEventListener('submit',handleSubmit);
    document.getElementById('clearBtn').addEventListener('click',clearForm);
    document.getElementById('refreshBtn').addEventListener('click',loadRosterList);
  </script>
</body>
</html>
