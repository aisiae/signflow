<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>교육 명단 관리</title>
  <style>
    :root{--bg:#0b0d12;--card:#121620;--muted:#94a3b8;--border:#233046;--ink:#e5e7eb;--primary:#1d4ed8;--success:#10b981;--warning:#f59e0b;--error:#ef4444}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,'Noto Sans KR',sans-serif;padding:20px}
    .container{max-width:800px;margin:0 auto}.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:32px;margin-bottom:24px;box-shadow:0 10px 25px rgba(0,0,0,.2)}
    h1{margin:0 0 8px;color:var(--ink)}.subtitle{color:var(--muted);margin-bottom:32px}
    .form-group{margin-bottom:20px}.form-row{display:grid;gap:16px;grid-template-columns:1fr 1fr}@media(max-width:768px){.form-row{grid-template-columns:1fr}}
    label{display:block;font-weight:600;margin-bottom:8px;color:var(--ink)}
    input[type="text"],input[type="date"],textarea{width:100%;padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:#0f1320;color:var(--ink);font-size:16px;font-family:inherit;transition:border-color .3s}
    textarea{min-height:150px;resize:vertical} input:focus,textarea:focus{outline:none;border-color:var(--primary)}
    .btn{border:1px solid var(--border);background:#101826;color:var(--ink);padding:12px 24px;border-radius:10px;cursor:pointer;font-size:16px;font-weight:500;transition:.3s;text-decoration:none;display:inline-flex;align-items:center;gap:8px;margin-right:12px;margin-bottom:8px}
    .btn:hover{background:#1a2332;border-color:var(--primary)}.btn.primary{border-color:#2563eb;background:var(--primary)}.btn.primary:hover{background:#1e40af}
    .btn.success{border-color:var(--success);background:var(--success);color:#000}.btn.warning{border-color:var(--warning);background:var(--warning);color:#000}.btn:disabled{opacity:.6;cursor:not-allowed}
    .status{padding:12px 16px;border-radius:8px;margin:16px 0;font-weight:500;display:none}
    .status.success{background:rgba(16,185,129,.2);color:var(--success);border:1px solid var(--success)}
    .status.error{background:rgba(239,68,68,.2);color:var(--error);border:1px solid var(--error)}
    .status.info{background:rgba(29,78,216,.2);color:var(--primary);border:1px solid var(--primary)}
    .back-link{position:fixed;top:20px;left:20px;color:var(--muted);text-decoration:none;font-size:14px;padding:8px 12px;border:1px solid var(--border);border-radius:6px;background:var(--card);transition:.3s}
    .back-link:hover{color:var(--ink);border-color:var(--primary)} .help-text{font-size:14px;color:var(--muted);margin-top:4px}
    .url-box{background:#0f1320;border:2px solid var(--primary);border-radius:12px;padding:20px;margin-top:20px;text-align:center}
    .main-url{font-family:'Courier New',monospace;font-size:18px;font-weight:bold;color:var(--primary);word-break:break-all;margin-bottom:12px}
    .copy-btn{padding:8px 16px;background:var(--primary);border:none;border-radius:6px;color:#fff;cursor:pointer;font-weight:500;transition:.3s}
    .copy-btn:hover{background:#1e40af}
    .feature-box{background:#0a0f19;border:1px solid var(--border);border-radius:10px;padding:16px;margin-top:20px}
    .feature-title{font-weight:600;color:var(--success);margin-bottom:8px}
    .loading-spinner{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-radius:50%;border-top-color:var(--primary);animation:spin 1s ease-in-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <a href="index.html" class="back-link">← 메인 페이지</a>

  <div class="container">
    <div class="card">
      <h1>교육 명단 관리 시스템</h1>
      <p class="subtitle">교육 정보와 참여자 명단을 등록하면 메인 페이지에서 바로 사용할 수 있습니다.</p>

      <form id="rosterForm">
        <div class="form-row">
          <div class="form-group">
            <label for="course">교육명 *</label>
            <input type="text" id="course" placeholder="예: AI 관리자 교육" required>
          </div>
          <div class="form-group">
            <label for="date">교육일정 *</label>
            <input type="date" id="date" required>
            <div class="help-text">교육이 예정된 날짜를 선택해주세요</div>
          </div>
        </div>

        <div class="form-group">
          <label for="memo">메모 (선택사항)</label>
          <input type="text" id="memo" placeholder="예: 1차수, 오후반">
        </div>

        <div class="form-group">
          <label for="names">참여자 명단 *</label>
          <textarea id="names" placeholder="홍길동,김철수,이영희&#10;또는&#10;홍길동&#10;김철수&#10;이영희&#10;&#10;콤마(,)로 구분하거나 한 줄에 한 명씩 입력해주세요" required></textarea>
        </div>

        <div style="text-align:center;">
          <button type="submit" class="btn primary" id="saveBtn">
            <span id="saveText">명단 등록하기</span>
            <span id="saveSpinner" class="loading-spinner" style="display:none;"></span>
          </button>
          <button type="button" class="btn" id="clearBtn">초기화</button>
          <!-- PDF 기능 준비 중: Apps Script action=pdf 추가 후 활성화
          <button type="button" class="btn warning" id="pdfBtn">일괄 PDF 생성</button>
          -->
        </div>

        <div id="status" class="status"></div>
      </form>

      <div class="url-box">
        <div class="main-url" id="mainUrl"></div>
        <button class="copy-btn" onclick="copyMainUrl()">메인 주소 복사</button>
        <div class="help-text" style="margin-top:12px;">명단 등록 후 위 주소를 참여자들에게 공유하세요</div>
      </div>

      <div class="feature-box">
        <div class="feature-title">📋 사용 방법</div>
        <div class="help-text">
          1) 교육 정보와 참여자 명단 입력 → "명단 등록하기"<br>
          2) 메인 주소 공유 → 참여자가 본인 이름 클릭 후 서명<br>
          3) 서명 이미지는 Google Drive(교육서명_이미지)에 저장, 시트(Signatures)에 링크 기록
        </div>
      </div>
    </div>
  </div>

  <script>
    // 👇 새로 배포한 Apps Script WebApp URL
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyW1UrLrRlGQmo7DDFx_vR6P9sarxLem_tYiA6eU_L3FRv2k7TBvTQIqejhD52tul6unQ/exec';

    document.addEventListener('DOMContentLoaded', ()=>{
      const today=new Date().toISOString().split('T')[0];
      if(!document.getElementById('date').value) document.getElementById('date').value=today;
      const base=window.location.origin+window.location.pathname.replace('admin.html','index.html');
      document.getElementById('mainUrl').textContent=base;
    });

    function showStatus(m,t='info'){const el=document.getElementById('status');el.textContent=m;el.className=`status ${t}`;el.style.display='block';if(t==='success'||t==='error'){setTimeout(()=>el.style.display='none',8000);}}
    function hideStatus(){document.getElementById('status').style.display='none';}
    function setLoading(b){const btn=document.getElementById('saveBtn');const text=document.getElementById('saveText');const sp=document.getElementById('saveSpinner');btn.disabled=b;text.style.display=b?'none':'inline';sp.style.display=b?'inline-block':'none';}

    function handleSubmit(e){
      e.preventDefault();
      const course=document.getElementById('course').value.trim();
      const date=document.getElementById('date').value;
      const memo=document.getElementById('memo').value.trim();
      const namesText=document.getElementById('names').value.trim();
      if(!course||!date||!namesText){showStatus('교육명, 교육일정, 참여자 명단을 모두 입력해주세요.','error');return;}
      const names=(namesText.includes(',')?namesText.split(','):namesText.split('\n')).map(n=>n.trim()).filter(Boolean);
      if(!names.length){showStatus('올바른 참여자 명단을 입력해주세요.','error');return;}

      setLoading(true); showStatus('명단을 등록하는 중...','info');
      const cb='saveRosterCallback_'+Date.now(); const to=setTimeout(()=>{showStatus('서버 응답 시간이 초과되었습니다.','error');cleanup();},30000);
      function cleanup(){clearTimeout(to);delete window[cb];const s=document.getElementById('save-jsonp-script');if(s&&s.parentNode)document.head.removeChild(s);setLoading(false);}
      window[cb]=function(result){try{if(result&&result.ok){showStatus(`명단이 등록되었습니다! (${names.length}명)`,`success`);document.getElementById('names').value='';}else{throw new Error(result?.error||'명단 등록 실패');}}catch(err){showStatus('명단 등록 실패: '+err.message,'error');}finally{cleanup();}};
      const params=new URLSearchParams({action:'saveRoster',course,date,memo,names:names.join(','),callback:cb,_t:Date.now()});
      const s=document.createElement('script'); s.id='save-jsonp-script'; s.src=`${APPS_SCRIPT_URL}?${params.toString()}`; s.onerror=function(){showStatus('서버 연결 오류','error');cleanup();}; document.head.appendChild(s);
    }

    function clearForm(){document.getElementById('course').value='';document.getElementById('date').value=new Date().toISOString().split('T')[0];document.getElementById('memo').value='';document.getElementById('names').value='';hideStatus();}
    function copyMainUrl(){const url=document.getElementById('mainUrl').textContent; if(navigator.clipboard&&window.isSecureContext){navigator.clipboard.writeText(url).then(()=>showStatus('메인 주소가 복사되었습니다.','success')).catch(()=>fallback(url));} else {fallback(url);} }
    function fallback(text){const ta=document.createElement('textarea');ta.value=text;ta.style.position='fixed';document.body.appendChild(ta);ta.focus();ta.select();try{document.execCommand('copy')?showStatus('메인 주소가 복사되었습니다.','success'):showStatus('복사 실패. 수동 복사해주세요.','error');}catch(e){showStatus('복사 실패. 수동 복사해주세요.','error');}document.body.removeChild(ta);}

    document.getElementById('rosterForm').addEventListener('submit',handleSubmit);
    document.getElementById('clearBtn').addEventListener('click',clearForm);
  </script>
</body>
</html>
