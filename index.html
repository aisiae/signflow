<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>교육 이수 확인 시스템</title>
  <style>
    :root{--bg:#0b0d12;--card:#121620;--muted:#94a3b8;--border:#233046;--ink:#e5e7eb;--primary:#1d4ed8;--success:#10b981}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,'Noto Sans KR',sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .container{max-width:800px;width:100%}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:32px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.3)}
    .course-info{background:#0f1320;padding:20px;border-radius:12px;margin-bottom:30px;text-align:center}
    .course-title{font-size:24px;font-weight:700;color:var(--primary);margin-bottom:8px}
    .course-details{color:var(--muted);font-size:16px}
    .course-period{color:var(--success);font-weight:600;margin-top:8px}
    .person-btn{display:inline-block;background:#1a2332;border:1px solid var(--border);color:var(--ink);padding:12px 20px;margin:6px;border-radius:25px;text-decoration:none;font-weight:500;transition:.3s}
    .person-btn:hover{background:var(--primary);border-color:var(--primary);transform:translateY(-2px)}
    .admin-link{position:fixed;top:20px;right:20px;background:var(--card);border:1px solid var(--border);padding:8px 12px;border-radius:6px;color:var(--muted);text-decoration:none;font-size:14px}
    .admin-link:hover{color:var(--ink);border-color:var(--primary)}
    .loading{text-align:center;color:var(--muted);font-size:18px}
    .error{background:rgba(239,68,68,.2);color:#ef4444;border:1px solid #ef4444;padding:16px;border-radius:8px;margin:20px 0;text-align:center}
    .no-roster{text-align:center;color:var(--muted)}
    .btn{background:var(--primary);color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-block;margin-top:16px;font-weight:500;transition:.3s}
    .btn:hover{background:#1e40af}
    h1{text-align:center;margin:0 0 8px;font-size:28px}
    .subtitle{text-align:center;color:var(--muted);margin-bottom:32px;font-size:18px}
    .names-grid{text-align:center}
    .status-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--success);margin-left:8px;animation:pulse 2s infinite}
    @keyframes pulse{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}
  </style>
</head>
<body>
  <a href="admin.html" class="admin-link">관리자 페이지</a>

  <div class="container">
    <div class="card">
      <h1>교육 이수 확인 시스템</h1>
      <p class="subtitle">본인의 이름을 클릭하여 서명해주세요</p>

      <div id="loading" class="loading">
        <div>명단을 불러오는 중...</div><div class="status-indicator"></div>
      </div>
      <div id="error" class="error" style="display:none;"></div>

      <div id="roster-content" style="display:none;">
        <div class="course-info">
          <div class="course-title" id="course-title"></div>
          <div class="course-details" id="course-details"></div>
          <div class="course-period" id="course-period"></div>
        </div>
        <h2 style="text-align:center;">참여자 명단 (<span id="person-count"></span>명)</h2>
        <div class="names-grid" id="names-grid"></div>
      </div>

      <div id="no-roster" class="no-roster" style="display:none;">
        <h2>등록된 명단이 없습니다</h2>
        <p>관리자 페이지에서 먼저 명단을 등록해주세요.</p>
        <a href="admin.html" class="btn">관리자 페이지로 이동</a>
      </div>
    </div>
  </div>

  <script>
    // 👇 새로 배포한 Apps Script WebApp URL
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbydk9Ib0UM3rfJwaorUfb12fN2zETx22jpm0Cdh6hQeOubqDmMkp0Zn09asis0qMPbh7Q/exec';

    function loadRoster(){
      const cb='loadRosterCallback_'+Date.now();
      const to=setTimeout(()=>{showError('서버 응답 시간이 초과되었습니다. 새로고침해주세요.');cleanup();},30000);
      function cleanup(){clearTimeout(to);delete window[cb];const s=document.getElementById('jsonp-script');if(s&&s.parentNode)document.head.removeChild(s);}
      window[cb]=function(result){
        document.getElementById('loading').style.display='none';
        try{
          if(!result||!result.ok){throw new Error(result?.error||'명단을 불러올 수 없습니다.');}
          if(!result.hasRoster){document.getElementById('no-roster').style.display='block';return;}
          
          document.getElementById('course-title').textContent=result.course||'교육명 없음';
          
          // 메모 처리
          let details = '';
          if(result.memo){
            details = result.memo;
          }
          document.getElementById('course-details').textContent=details;
          
          // 교육 기간 표시
          let period = '';
          if(result.startDate && result.endDate){
            if(result.startDate === result.endDate){
              period = `교육일자: ${result.startDate}`;
            } else {
              period = `교육기간: ${result.startDate} ~ ${result.endDate}`;
            }
          }
          document.getElementById('course-period').textContent=period;
          
          document.getElementById('person-count').textContent=result.count||0;
          const grid=document.getElementById('names-grid'); grid.innerHTML='';
          (result.names||[]).forEach(name=>{
            if(!name||!name.trim())return;
            const params=new URLSearchParams({
              name:name.trim(),
              course:result.course||'',
              startDate:result.startDate||'',
              endDate:result.endDate||''
            });
            if(result.memo)params.set('memo',result.memo);
            const a=document.createElement('a'); 
            a.href=`sign.html?${params.toString()}`; 
            a.className='person-btn'; 
            a.textContent=name.trim();
            grid.appendChild(a);
          });
          document.getElementById('roster-content').style.display='block';
        }catch(e){showError('명단 처리 중 오류: '+e.message);}finally{cleanup();}
      };
      const script=document.createElement('script');
      script.id='jsonp-script';
      script.src=`${APPS_SCRIPT_URL}?action=getRoster&callback=${cb}&_t=${Date.now()}`;
      script.onerror=function(){showError('서버에 연결할 수 없습니다.');cleanup();};
      document.head.appendChild(script);
    }
    function showError(msg){document.getElementById('loading').style.display='none';const el=document.getElementById('error');el.style.display='block';el.textContent=msg;}
    document.addEventListener('DOMContentLoaded',loadRoster);
  </script>
</body>
</html>


