<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>êµìœ¡ ì´ìˆ˜ í™•ì¸ ì‹œìŠ¤í…œ</title>
  <style>
    :root{--bg:#0b0d12;--card:#121620;--muted:#94a3b8;--border:#233046;--ink:#e5e7eb;--primary:#1d4ed8;--success:#10b981}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,'Noto Sans KR',sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .container{max-width:800px;width:100%}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:32px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.3)}
    .course-info{background:#0f1320;padding:20px;border-radius:12px;margin-bottom:30px;text-align:center}
    .course-title{font-size:24px;font-weight:700;color:var(--primary);margin-bottom:8px}
    .course-details{color:var(--muted);font-size:16px}
    .course-period{color:var(--success);font-weight:600;margin-top:8px}
    .person-btn{display:inline-block;background:#1a2332;border:1px solid var(--border);color:var(--ink);padding:12px 20px;margin:6px;border-radius:25px;text-decoration:none;font-weight:500;transition:.3s}
    .person-btn:hover{background:var(--primary);border-color:var(--primary);transform:translateY(-2px)}
    .admin-link{position:fixed;top:20px;right:20px;background:var(--card);border:1px solid var(--border);padding:8px 12px;border-radius:6px;color:var(--muted);text-decoration:none;font-size:14px}
    .admin-link:hover{color:var(--ink);border-color:var(--primary)}
    .loading{text-align:center;color:var(--muted);font-size:18px}
    .error{background:rgba(239,68,68,.2);color:#ef4444;border:1px solid #ef4444;padding:16px;border-radius:8px;margin:20px 0;text-align:center}
    .no-roster{text-align:center;color:var(--muted)}
    .btn{background:var(--primary);color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-block;margin-top:16px;font-weight:500;transition:.3s}
    .btn:hover{background:#1e40af}
    h1{text-align:center;margin:0 0 8px;font-size:28px}
    .subtitle{text-align:center;color:var(--muted);margin-bottom:32px;font-size:18px}
    .names-grid{text-align:center}
    .status-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--success);margin-left:8px;animation:pulse 2s infinite}
    @keyframes pulse{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}
  </style>
</head>
<body>
  <a href="admin.html" class="admin-link">ê´€ë¦¬ì í˜ì´ì§€</a>

  <div class="container">
    <div class="card">
      <h1>êµìœ¡ ì´ìˆ˜ í™•ì¸ ì‹œìŠ¤í…œ</h1>
      <p class="subtitle">ë³¸ì¸ì˜ ì´ë¦„ì„ í´ë¦­í•˜ì—¬ ì„œëª…í•´ì£¼ì„¸ìš”</p>

      <div id="loading" class="loading">
        <div>ëª…ë‹¨ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div><div class="status-indicator"></div>
      </div>
      <div id="error" class="error" style="display:none;"></div>

      <div id="roster-content" style="display:none;">
        <div class="course-info">
          <div class="course-title" id="course-title"></div>
          <div class="course-details" id="course-details"></div>
          <div class="course-period" id="course-period"></div>
        </div>
        <h2 style="text-align:center;">ì°¸ì—¬ì ëª…ë‹¨ (<span id="person-count"></span>ëª…)</h2>
        <div class="names-grid" id="names-grid"></div>
      </div>

      <div id="no-roster" class="no-roster" style="display:none;">
        <h2>ë“±ë¡ëœ ëª…ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤</h2>
        <p>ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë¨¼ì € ëª…ë‹¨ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>
        <a href="admin.html" class="btn">ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™</a>
      </div>
    </div>
  </div>

  <script>
    // ğŸ‘‡ ìƒˆë¡œ ë°°í¬í•œ Apps Script WebApp URL
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbydk9Ib0UM3rfJwaorUfb12fN2zETx22jpm0Cdh6hQeOubqDmMkp0Zn09asis0qMPbh7Q/exec';

    function loadRoster(){
      const cb='loadRosterCallback_'+Date.now();
      const to=setTimeout(()=>{showError('ì„œë²„ ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');cleanup();},30000);
      function cleanup(){clearTimeout(to);delete window[cb];const s=document.getElementById('jsonp-script');if(s&&s.parentNode)document.head.removeChild(s);}
      window[cb]=function(result){
        document.getElementById('loading').style.display='none';
        try{
          if(!result||!result.ok){throw new Error(result?.error||'ëª…ë‹¨ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
          if(!result.hasRoster){document.getElementById('no-roster').style.display='block';return;}
          
          document.getElementById('course-title').textContent=result.course||'êµìœ¡ëª… ì—†ìŒ';
          
          // ë©”ëª¨ ì²˜ë¦¬
          let details = '';
          if(result.memo){
            details = result.memo;
          }
          document.getElementById('course-details').textContent=details;
          
          // êµìœ¡ ê¸°ê°„ í‘œì‹œ
          let period = '';
          if(result.startDate && result.endDate){
            if(result.startDate === result.endDate){
              period = `êµìœ¡ì¼ì: ${result.startDate}`;
            } else {
              period = `êµìœ¡ê¸°ê°„: ${result.startDate} ~ ${result.endDate}`;
            }
          }
          document.getElementById('course-period').textContent=period;
          
          document.getElementById('person-count').textContent=result.count||0;
          const grid=document.getElementById('names-grid'); grid.innerHTML='';
          (result.names||[]).forEach(name=>{
            if(!name||!name.trim())return;
            const params=new URLSearchParams({
              name:name.trim(),
              course:result.course||'',
              startDate:result.startDate||'',
              endDate:result.endDate||''
            });
            if(result.memo)params.set('memo',result.memo);
            const a=document.createElement('a'); 
            a.href=`sign.html?${params.toString()}`; 
            a.className='person-btn'; 
            a.textContent=name.trim();
            grid.appendChild(a);
          });
          document.getElementById('roster-content').style.display='block';
        }catch(e){showError('ëª…ë‹¨ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: '+e.message);}finally{cleanup();}
      };
      const script=document.createElement('script');
      script.id='jsonp-script';
      script.src=`${APPS_SCRIPT_URL}?action=getRoster&callback=${cb}&_t=${Date.now()}`;
      script.onerror=function(){showError('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');cleanup();};
      document.head.appendChild(script);
    }
    function showError(msg){document.getElementById('loading').style.display='none';const el=document.getElementById('error');el.style.display='block';el.textContent=msg;}
    document.addEventListener('DOMContentLoaded',loadRoster);
  </script>
</body>
</html>


